<%= form_with model: post, class: "space-y-6" do |f| %>
  <%# エラーメッセージ %>
  <% if post.errors.any? %>
    <div class="rounded-xl border border-rose-200 bg-rose-50 px-4 py-3">
      <p class="text-sm font-medium text-rose-800">
        <%= t("posts.form.errors_title", count: post.errors.count) %>
      </p>
      <ul class="mt-2 list-disc pl-5 text-sm text-rose-700 space-y-1">
        <% order = [:prefecture_code, :category, :body, :place_name] %>
        <% order.each do |attr| %>
          <% post.errors.full_messages_for(attr).each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%# 都道府県 %>
  <div class="space-y-1">
    <%= f.label :prefecture_code, class: "block text-sm font-medium text-[#5B5652]" do %>
      <%= Post.human_attribute_name(:prefecture_code) %>
      <span class="ml-1 text-xs font-semibold text-[#92B099]"><%= t("posts.form.required_mark") %></span>
    <% end %>
    <%= f.collection_select :prefecture_code,
        JpPrefecture::Prefecture.all, :code, :name,
        { prompt: t("posts.form.prefecture_prompt") },
        class: "w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-slate-800 shadow-sm focus:border-[#92B099] focus:ring-2 focus:ring-[#92B099]/40" %>
    <p class="text-xs text-slate-500"><%= t("posts.form.prefecture_help") %></p>
  </div>

  <%# カテゴリ %>
  <div class="space-y-1">
    <%= f.label :category_id, class: "block text-sm font-medium text-[#5B5652]" do %>
      <%= Post.human_attribute_name(:category) %>
      <span class="ml-1 text-xs font-semibold text-[#92B099]"><%= t("posts.form.required_mark") %></span>
    <% end %>
    <%= f.collection_select :category_id,
          Category.order(:name), :id, :name,
          { prompt: t("posts.form.category_prompt") },
          class: "w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-slate-800 shadow-sm focus:border-[#92B099] focus:ring-2 focus:ring-[#92B099]/40" %>
  </div>

  <%# コメント（本文） %>
  <div class="space-y-1">
    <%= f.label :body, class: "block text-sm font-medium text-[#5B5652]" do %>
      <%= Post.human_attribute_name(:body) %>
      <span class="ml-1 text-xs font-semibold text-[#92B099]"><%= t("posts.form.required_mark") %></span>
    <% end %>
    <%= f.text_area :body,
          rows: 6,
          placeholder: t("posts.form.body_placeholder"),
          class: "w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-slate-800 shadow-sm focus:border-[#92B099] focus:ring-2 focus:ring-[#92B099]/40" %>
  </div>

  <%# 画像 %>
  <div class="space-y-2">
    <div class="flex items-baseline justify-between">
      <%= f.label :image, t("posts.form.image_label"), class: "block text-sm font-medium text-[#5B5652]" %>
    </div>

    <%# 現在の画像 %>
    <% if @post.image.attached? %>
      <p class="text-xs text-slate-500">
        <%= t("posts.form.image_help") %>
      </p>
      <div class="flex items-center gap-3 rounded-xl border border-slate-200 bg-slate-50 p-3">
        <div class="h-10 w-10 overflow-hidden rounded-lg bg-white ring-1 ring-slate-200 flex items-center justify-center">
          <%= image_tag @post.image_show, class: "h-full w-full object-cover" %>
        </div>

        <div class="min-w-0">
          <p class="text-xs text-slate-500"><%= t("posts.form.current_image") %></p>
          <p class="truncate text-sm font-medium text-slate-700">
            <%= @post.image.filename.to_s %>
          </p>
        </div>
      </div>
    <% end %>

    <%= f.file_field :image,
          accept: "image/*",
          class: "block w-full rounded-xl border border-slate-200 bg-white text-sm text-slate-700
                  file:mr-3 file:rounded-lg file:border-0 file:bg-[#92B099]/40 file:px-4 file:py-2
                  file:text-sm file:font-medium file:text-[#5B5652] hover:file:bg-[#92B099]/55
                  focus:outline-none focus:ring-2 focus:ring-[#92B099]/35" %>
  </div>

  <%# 場所名 Google PlaceはMVP後 %>
  <div class="space-y-1">
    <%= f.label :place_name, t("posts.form.place_label"), class: "block text-sm font-medium text-[#5B5652]" %>
    <%= f.text_field :place_name,
          placeholder: t("posts.form.place_placeholder"),
          class: "w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-slate-800 shadow-sm focus:border-[#92B099] focus:ring-2 focus:ring-[#92B099]/40" %>
  </div>

  <%# ボタン %>
  <div class="pt-4 text-center space-y-3">
    <%= f.submit nil,
          class: "inline-flex items-center justify-center rounded-lg
                bg-[#92B099] px-8 py-3 text-base leading-none font-semibold text-white
                shadow-sm hover:bg-[#84A88F]
                focus:outline-none focus:ring-2 focus:ring-[#92B099]/50" %>

    <div>
      <%= link_to t("posts.form.back"), posts_path,
            class: "text-sm text-slate-600 hover:text-slate-800
                  underline underline-offset-4" %>
    </div>
  </div>
<% end %>
